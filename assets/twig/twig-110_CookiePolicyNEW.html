<script>
if(typeof lang === 'undefined') var lang = 'en';
var variation_lang = '{{ landing.Lang }}';

if(typeof cGetCookie === 'undefined') {
  var cGetCookie = function(name) {
    var value = `; ${document.cookie}`;
    var parts = value.split(`; ${name}=`);
    var cookiesArray = parts.pop().split(';').shift();
    if (parts.length > 0) return decodeURIComponent(cookiesArray);
  }
}
</script>

<style>
:root {
  --overlay-bg-color: rgba(0,0,0,.8);

  --modal-bg-color: #ffffff;
  --modal-box-shadow: 3px 3px 10px rgba(0,0,0,.2);
  --modal-title-color: #7f6c9d;
  --modal-txt-color: #808080;
  --modal-border-radius: 10px;

  --btn-border-radius: 7px;
  --btn-text-color: #ffffff;
  --btn-bg-color: #2ed283;
  --btn-border-color: #2ed283;
  --btn-text-color: #ffffff;
  --btn-bg-hover: #36e08b;
  --btn-border-color-hover: #36e08b;

  --btn-pref-text-color: #808080;
  --btn-pref-bg-color: #ffffff;
  --btn-pref-border-color: #808080;
  --btn-pref-text-color-hover: #ffffff;
  --btn-pref-bg-hover: #808080;
  --btn-pref-border-color-hover: #808080;

  --link-color: #23a0c6;

  --modal-close-size: 20px;
  --modal-close-color: #ccc;
  --modal-close-thickness: 2px;
  --badge-color: #e6e6e6;
}
div.hidden {
  display: none;
}
div.cookies_policy_banner {
  line-height: 1.2;
}

div.cookies_policy_banner.cookies_detail_open{
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 11000;
  padding: 2em;
  display: flex !important;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;

  background-color: var(--overlay-bg-color);
}

/* MODAL  */
div.cookies_modal > div,
div.cookies-dialog-policy{
  padding:2em;
  box-sizing: border-box;
  position: relative;
  font-size: 13px;
  margin: 0 auto;

  background-color: var(--modal-bg-color);
  box-shadow: var(--modal-box-shadow);
  border-radius: var(--modal-border-radius);
  color: var(--modal-txt-color);
}

div.cookies-dialog-detail,
div.cookies-dialog-policy-content {
  font-size: 14px;
}

div.cookies-dialog-detail > h4,
div.cookies-dialog-policy-content > h2 {
  text-transform: uppercase;
  margin: 0 0 30px;
  font-size: 21px;

}
div.cookies-dialog-policy-content > h2 {
  margin-top: 10px;
}

div.cookies-dialog-close {
  position: absolute;
  top: 25px;
  right: 25px;
  cursor: pointer;
  background-color: #fff;

  width: var(--modal-close-size);
  height: var(--modal-close-size);
}

div.cookies-dialog-close:before,
div.cookies-dialog-close:after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;

  top: calc((var(--modal-close-size) - var(--modal-close-thickness)) / 2);
  height: var(--modal-close-thickness);
  background: var(--modal-close-color);
  border-radius: var(--modal-close-thickness);
}

div.cookies-dialog-close:before {
  transform: rotate(45deg);
}

div.cookies-dialog-close:after {
  transform: rotate(-45deg);
}

@media all and (max-width: 768px){

  div.cookies-dialog-detail > h4,
  div.cookies-dialog-policy-content > h2{
    margin-bottom: 20px;
  }

  div.cookies-dialog-close{
    top: 15px;
    right: 15px;
  }


  div.cookies-dialog-main{
    font-size: 12px;
  }

}

/* DIALOG MAIN */
div.cookies-dialog-main{
  position: fixed !important;
  z-index: 11000;
  bottom: 1em;
  left: 1em;
  width: 100%;
  max-width: 315px;
}

div.cookies-dialog-main > span {
  display: block;
  margin: 0 0 1em;
  line-height: 1.2em;
}

div.cookies-dialog-main > h4 {
  display: none;
}

.cookies_policy_minimized{
  display: flex;
  width: 45px;
  height: 45px;
  align-items: center;
  justify-content: center;
  background-color: #fff;
  box-shadow: var(--modal-box-shadow);
  border-radius: 100px;
  transform: scale(.8);
}

.cookies_policy_minimized a{
  margin: 15px auto 0;
}

@media all and (max-width: 768px){
  div.cookies-dialog-main{
    bottom: initial;
    top: 1em;
    left: 50%;
    transform: translatex(-50%);
  }
}

/* DIALOG DETAIL */
@media all and (min-width: 769px){
  
  .cookies-dialog-detail{
    max-width: 70%;
  }

}

/* POLICY */
div.cookies_policy_banner a {
  text-decoration: underline;

  color: var(--link-color);
}

div.cookies_policy_banner label {
  font-weight: 700;
  text-transform:none;
  letter-spacing: 0;
  font-size: 1.1em;
  margin: 1.5em 0 .8em;
}

div.cookies_policy_banner label input{
  opacity: 1;
  z-index: 0;
  position: static;
  margin: 0;
}

div.cookies_policy_banner label span{
  padding-left: 10px;
}

div.cookies-dialog-policy ul {
  margin: 20px 0;
  padding-left: 2.5em;
}

div.cookies-dialog-policy ul li {
  margin: 0 0 10px;
}

div.cookies-dialog-policy ul li > ul{
  padding-left: 15px;
}

div.cookies-dialog-policy p+ul {
  margin-top:5px;
}

div.cookies-dialog-policy b{
  font-weight: 700;
}

div.cookies-dialog-policy p b{
  display: block;
  margin: 20px 0 10px;
  font-size: 1.1em;
}

.cookies-dialog-policy-content{
  max-height: 80vh;
  overflow-y: auto;
}

@media all and (max-width: 768px) {
  div.cookies-dialog-policy ul{padding-left: 20px}
}


/* BUTTONS  */
div.cookies_policy_banner button,
.cookies_policy_btn {
  all: unset;
  display: inline-block;
  padding: .4em .8em;
  text-align: center;
  cursor: pointer;
  white-space: nowrap;
  font-size: 14px !important;

  transition: all .2s ease-in-out;

  border-radius: var(--btn-border-radius);
  background-color: var(--btn-bg-color);
  border: 1px solid var(--btn-border-color);
  color: var(--btn-text-color);
}

div.cookies_policy_banner button:hover,
.cookies_policy_btn:hover{
  background-color: var(--btn-bg-hover);
  border-color: var(--btn-border-color-hover);
}

div.cookies_policy_banner button.cookies-dialog-switch {
  background-color: var(--btn-pref-bg-color);
  color: var(--btn-pref-text-color);
  border: 1px solid var(--btn-pref-border-color) !important;
}

div.cookies_policy_banner button.cookies-dialog-switch:hover {
  background-color: var(--btn-pref-bg-hover);
  color: var(--btn-pref-text-color-hover);
  border: 1px solid var(--btn-pref-border-color-hover) !important;
}

.cookies-dialog-detail .cookies-dialog-accept-detail{
  margin-top: 30px;
  font-size: 1em;
}

/* SHIELD */
/* Shield based on https://css.gg/shield */
div.cookies_policy_minimized {
  position: fixed;
  left: 1.25em;
  bottom: 1.25em;
  z-index: 1100;
}
div.cookies_policy_minimized a {
  display: block;
  width: 14px;
  height: 18px;
  box-sizing: border-box;
  cursor: pointer;
  transform: scale(1.5);
  border-top: 2px solid var(--modal-txt-color);
  font-size: 0;
}
div.cookies_policy_minimized a:after,
div.cookies_policy_minimized a:before {
  content: '';
  display: block;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  border-radius: 3px;
  width: 8px;
  height: 16px;
  border: 2px solid var(--modal-txt-color);
}
div.cookies_policy_minimized a:before {
  border-bottom-left-radius: 40px;
  border-right: 0;
  left: 0;
}
div.cookies_policy_minimized a:after {
  border-bottom-right-radius: 40px;
  border-left: 0;
  right: 0;
}

div.cookies_policy_banner.cookies_detail_open{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,.8);
}

@media all and (max-width: 768px){
  
  div.cookies_policy_banner.cookies_detail_open{
    overflow-x: auto;
    align-items: flex-start;
  }

}
</style>

<div class="cookies_policy_banner" style="display: none;"><div class="cookies_modal"></div></div>
<div class="cookies_policy_minimized" style="display: none;"><a>Cookies</a></div>

<script>
var l = window.location;
var gdprUrl = 'https://gdpr-consent-recorder-prod.wemystic.workers.dev';
var __udeals_cookie_consent_full = { 'functional': true, 'measurement': false, 'marketing': false, 'aduserdata': false, 'adpersonalization': false };
var __udeals_cookie_consent_mode = __udeals_cookie_consent_full;
var __udeals_cookie_first = true;
var sessionCookie = cGetCookie('udeals_variation_uid');
var gdprRecorder = cGetCookie('gdpr_recorder');
if (!gdprRecorder) {
  setGdprCookie();
}

function jsonpCall() {
  return new Promise((resolve, reject) => {
    $.ajax({
      url: `${gdprUrl}/cookie`,
      dataType: 'jsonp',
      type: 'GET',
      data: '{}',
      contentType: 'application/json; charset=utf-8',
      dataType: 'jsonp',
      jsonp: 'callback',
      jsonpCallback: 'jsonpCallbackfunction',
      async: 'true',
      error: function (error) {
        reject(error);
      },
      success: function (data) {
        resolve(data);
      },
    });
  });
}

function setGdprCookie() {
  var expirationDate = new Date();
  expirationDate.setMinutes(expirationDate.getMinutes() + 30);
  if (gdprRecorder) {
    document.cookie = `gdpr_recorder=${gdprRecorder}; expires=${expirationDate.toUTCString()}`;
    gdprRecorder = cGetCookie('gdpr_recorder');
  } else {
    jsonpCall()
      .then(function (data) {
        var uuid = data.uuid;
        document.cookie = `gdpr_recorder=${uuid}:${Date.now()}; expires=${expirationDate.toUTCString()}`;
        gdprRecorder = cGetCookie('gdpr_recorder');
      });
  }
}

function cookies_disclosure_load() {
  var baseUrl = 'https://legal.wemystic.net',
      endUrl;

  $.ajax({
    url: baseUrl + '/country_lang_map.json',
    dataType: 'text',
    crossDomain: true,
    cache: false
  }).done(function(data) {
    var json = JSON.parse(data),
        use_lang = 'en',
        available_lang = ['de', 'en', 'es', 'fr', 'it', 'pt'];

    if(json && typeof lang !== 'undefined' && json[lang]) use_lang = json[lang];
    if(variation_lang !== '' && variation_lang !== use_lang && available_lang.includes(variation_lang) === true) use_lang = variation_lang;

    endUrl = baseUrl + '/' + use_lang + '/cookiesdisclosure-gcmv2.html';

    $.ajax({
      url: endUrl,
      dataType: 'text',
      crossDomain: true,
      cache: false
    })
    .done(function(data) {
      var cookiesDialogClose = document.createElement('div');
      cookiesDialogClose.className = 'cookies-dialog-close';
      cookiesDialogClose.dataset.anchor = 'cookies-dialog-detail';

      document.querySelector('div.cookies_modal').innerHTML = data;
      document.querySelector('div.cookies-dialog-detail').appendChild(cookiesDialogClose);
      document.querySelector('div.cookies_policy_banner').style = 'display: block';
      document.querySelector('div.cookies_policy_minimized').style = 'display: none';

      // if not the first time, then go to details
      if (!__udeals_cookie_first && typeof(cookies_dialog_open_details) === 'function') {
        cookies_dialog_open_details();
      }
    });
  });
}

function sendToKV(hasAcceptedAll) {
  setGdprCookie()
  var today = new Date();
  var day = today.toLocaleString('default', { day: 'numeric' });
  var weekday = today.toLocaleString('default', { weekday: 'short' });
  var month = today.toLocaleString('default', { month: 'short' });
  var year = today.toLocaleString('default', { year: 'numeric' });
  var time = today.getHours() + ':' + today.getMinutes() + ':' + today.getSeconds();
  var data = {
    'url': window.location.href,
    'key': gdprRecorder,
    'dateTime': `${weekday} ${month} ${day} ${year} ${time}`,
    'hasAcceptedAll': hasAcceptedAll
  }
  var settings = {
    'cache': false,
    'dataType': 'JSONP',
    'jsonpCallback': 'callback',
    'async': true,
    'crossDomain': true,
    'url': `${gdprUrl}/gdpr`,
    'method': 'GET',
    'headers': {
      'accept': 'application/json',
      'Access-Control-Allow-Origin':'*'
    },
    data: data,
  }
  $.ajax(settings)
    .done(() => {
      return true
    }).fail(() => {
      return false
    })
}

function cookies_dialog_open_details() {
  var current_mode = {};
  if (typeof(cookie_consent_current) === 'function') {
    current_mode = cookie_consent_current();
  }
  current_mode['functional'] = true;
  $('input.cookie-consent-detail').each(function(){
    $(this).attr('checked', current_mode[this.value] ? 'checked' : null);
  });

  document.querySelector('.cookies-dialog-main').style = 'display: none';
  document.querySelector('.cookies-dialog-detail').style = 'display: block';
  document.querySelector('.cookies_policy_banner').classList.add('cookies_detail_open');
}

function cookie_consent_update(mode) {
  var m1 = mode['marketing']   ? true : false,
      m2 = mode['measurement'] ? true : false,
      m3 = mode['functional'] ? true : false,
      m4 = mode['aduserdata'] ? true : false,
      m5 = mode['adpersonalization'] ? true : false,
      udata = {
        'ad_storage': m1 ? 'granted': 'denied',
        'analytics_storage': m2 ? 'granted': 'denied',
        'personalization_storage': m3 ? 'granted': 'denied',
        'aduserdata_storage': m4 ? 'granted': 'denied',
        'adpersonalization_storage': m5 ? 'granted': 'denied'
      };
  dataLayer.push({'event': 'uDealsConsentUpdate'});
}

function cookies_dialog_done(mode) {
  document.querySelector('div.cookies_policy_banner').classList.remove('cookies_detail_open');
  document.querySelectorAll('div.cookies_modal > div').forEach(el => el.style = 'display: none');

  __udeals_cookie_first = false;
  if (mode === undefined || mode === null)
    mode = __udeals_cookie_consent_full;

  storeCookieConsent(JSON.stringify(mode), null);
  __udeals_cookie_consent_mode = mode;

  cookie_consent_update(mode);
  document.querySelector('div.cookies_policy_banner').style = 'display: none';
  document.querySelector('div.cookies_policy_minimized').style = 'display: block';
}

function storeCookieConsent(value, exdays) {
  var expires = '';
  if (exdays != null) {
    var exdate = new Date();
    exdate.setDate(exdate.getDate() + exdays);
    expires = '; expires=' + exdate.toUTCString();
  }
  var c_name = 'udeals_cookies_policy';
  var c_value = escape(value) + '; path=/' + expires;
  document.cookie = c_name + '=' + c_value + '; SameSite=Strict';
}

function cookie_consent_current() {
  return __udeals_cookie_consent_mode;
}

function checkAllTrue(udata) {
  for(var key in udata) {
    if(!udata[key]) return false;
  }
  return true;
}

$(function() {
  var cookie_v = cGetCookie('udeals_cookies_policy');
  if (cookie_v) {
    try {
      var v = JSON.parse(cookie_v);
      __udeals_cookie_consent_mode = v;
      __udeals_cookie_first = false;
      document.querySelector('div.cookies_policy_banner').style = 'display: none';
      document.querySelector('div.cookies_policy_minimized').style = 'display: block';
    } catch(e) {
      cookies_disclosure_load();
    }
  } else {
    cookies_disclosure_load();
  }

  $(document).on('click', 'button.cookies-dialog-switch', function() {
    cookies_dialog_open_details();
  });
  $(document).on('click', 'button.cookies-dialog-accept', function() {
    if (typeof(cookies_dialog_done) === 'function') cookies_dialog_done(null);
    sendToKV(true)
  });
  $(document).on('click', 'button.cookies-dialog-accept-detail', function() {
    var udata = { 'functional': true, 'measurement': false, 'marketing': false, 'aduserdata': false, 'adpersonalization': false };
    $('div.cookies-dialog-detail').find('input.cookie-consent-detail:checked').each(function() {
      udata[this.value] = true;
    });
    sendToKV(checkAllTrue(udata))
    if (typeof(cookies_dialog_done) === 'function') cookies_dialog_done(udata);
  });

  $(document).on('click', 'div.cookies_policy_minimized a', function(e) {
    e.preventDefault();
    document.querySelector('div.cookies_policy_banner').style = 'display: block';
    document.querySelector('div.cookies_policy_minimized').style = 'display: none';
    cookies_disclosure_load();
    return false;
  });

  $(document).on('click', 'div.cookies_modal a.external_policy', function(e) {
    e.preventDefault();

    document.querySelectorAll('div.cookies_modal > div').forEach(el => el.style = 'display: none');

    if(document.querySelector('.cookies-dialog-policy')) {
      document.querySelector('.cookies-dialog-policy').remove();
    }

    var policyDiv = document.createElement('div');
    policyDiv.className = 'cookies-dialog-policy';
    policyDiv.style = 'display: none';
    document.querySelector('.cookies_modal').appendChild(policyDiv);

    var policyContentDiv = document.createElement('div');
    policyContentDiv.className = 'cookies-dialog-policy-content';

    var cookiesDialogClose = document.createElement('div');
    cookiesDialogClose.dataset.anchor = 'cookies-dialog-policy';
    cookiesDialogClose.className = 'cookies-dialog-close';

    var url = e.target.href;

    $.ajax({
      url: url,
      dataType: 'text',
      crossDomain: true,
      cache: false
    }).done(function(data) {
      policyContentDiv.innerHTML = data;
      policyDiv.appendChild(policyContentDiv);
      policyDiv.appendChild(cookiesDialogClose);
      policyDiv.style = 'display: block';
    });

    document.querySelector('div.cookies_policy_banner').classList.add('cookies_detail_open');
  });

  $(document).on('click', '.cookies-dialog-close', function(e) {
    e.preventDefault();
    document.querySelectorAll('div.cookies_modal > div').forEach(el => el.style = 'display: none');
    document.querySelector((__udeals_cookie_first ? 'div.cookies-dialog-main' : 'div.cookies_policy_minimized')).style = 'display: block';
    document.querySelector('div.cookies_policy_banner').classList.remove('cookies_detail_open');
  })
});
</script>